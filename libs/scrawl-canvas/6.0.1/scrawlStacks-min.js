/*! scrawl-canvas 2017-01-13 */
if(window.scrawl&&window.scrawl.work.extensions&&!window.scrawl.contains(window.scrawl.work.extensions,"stacks"))var scrawl=function(a){"use strict";return a.work.css=["all","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundOrigin","backgroundPosition","backgroundRepeat","border","borderBottom","borderBottomColor","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopStyle","borderTopWidth","borderWidth","clear","color","columns","content","counterIncrement","counterReset","cursor","direction","display","emptyCells","float","font","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontSynthesis","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","grid","gridArea","gridAutoColumns","gridAutoFlow","gridAutoPosition","gridAutoRows","gridColumn","gridColumnStart","gridColumnEnd","gridRow","gridRowStart","gridRowEnd","gridTemplate","gridTemplateAreas","gridTemplateRows","gridTemplateColumns","imageResolution","imeMode","inherit","inlineSize","isolation","letterSpacing","lineBreak","lineHeight","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBlockStart","marginBlockEnd","marginInlineStart","marginInlineEnd","marginBottom","marginLeft","marginRight","marginTop","marks","mask","maskType","maxWidth","maxHeight","maxBlockSize","maxInlineSize","maxZoom","minWidth","minHeight","minBlockSize","minInlineSize","minZoom","mixBlendMode","objectFit","objectPosition","offsetBlockStart","offsetBlockEnd","offsetInlineStart","offsetInlineEnd","orphans","overflow","overflowWrap","overflowX","overflowY","pad","padding","paddingBlockStart","paddingBlockEnd","paddingInlineStart","paddingInlineEnd","paddingBottom","paddingLeft","paddingRight","paddingTop","pageBreakAfter","pageBreakBefore","pageBreakInside","pointerEvents","position","prefix","quotes","rubyAlign","rubyMerge","rubyPosition","scrollBehavior","scrollSnapCoordinate","scrollSnapDestination","scrollSnapPointsX","scrollSnapPointsY","scrollSnapType","scrollSnapTypeX","scrollSnapTypeY","shapeImageThreshold","shapeMargin","shapeOutside","tableLayout","textAlign","textDecoration","textIndent","textOrientation","textOverflow","textRendering","textShadow","textTransform","textUnderlinePosition","unicodeRange","unset","verticalAlign","widows","willChange","wordBreak","wordSpacing","wordWrap"],a.work.xcss=["alignContent","alignItems","alignSelf","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction","backfaceVisibility","backgroundImage","backgroundSize","borderBottomLeftRadius","borderBottomRightRadius","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderRadius","borderTopLeftRadius","borderTopRightRadius","boxDecorationBreak","boxShadow","boxSizing","columnCount","columnFill","columnGap","columnRule","columnRuleColor","columnRuleStyle","columnRuleWidth","columnSpan","columnWidth","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","fontFeatureSettings","fontKerning","fontLanguageOverride","hyphens","imageRendering","imageOrientation","initial","justifyContent","linearGradient","opacity","order","orientation","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","resize","tabSize","textAlignLast","textCombineUpright","textDecorationColor","textDecorationLine","textDecorationStyle","touchAction","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","whiteSpace","writingMode"],a.pageInit=function(){a.getStacks(),a.device.canvas&&a.getCanvases(),a.getElements()},a.multiSectionBucketSort=function(b,c,d){var e,f,g,h,i,j,k,l,m;for(e=[[]],f=0,g=d.length;g>f;f++){for(j=!1,k=0,l=b.length;l>k;k++)if(m=a[b[k]][d[f]]){j=b[k];break}j&&(h=Math.floor(a[j][d[f]][c]),e[h]||(e[h]=[]),e[h].push(d[f]))}for(i=[],f=0,g=e.length;g>f;f++)e[f]&&i.push(e[f]);return[].concat.apply([],i)},a.getStacks=function(){var b,c,d,e,f,g,h,i,j=a.makeStack,k=a.makeElement,l=a.stk,m=a.elm,n=a.element;if(f=document.getElementsByClassName("scrawlstack"),g=[],f.length>0){for(b=0,c=f.length;c>b;b++)g.push(f[b]);for(b=0,c=f.length;c>b;b++){for(h=j({stackElement:g[b]}),d=0,e=l[h.name].children.length;e>d;d++)l[h.name].children[d].style.position="absolute","CANVAS"!==l[h.name].children[d].tagName?k({domElement:l[h.name].children[d],group:h.name}):l[h.name].children[d].className+=" stack:"+h.name;n[h.name]&&(h.group=n[h.name].group,delete n[h.name],delete m[h.name],a.removeItem(a.elementnames,h.name)),g[b].className.match(/withcanvas/)&&(i=document.createElement("canvas"),i.style.position="absolute",i.id=h.name+"_canvas",i.className="lockTo:"+h.name,l[h.name].appendChild(i))}return!0}return!1},a.getCanvases=function(){var b,c,d,e,f,g,h,i,j;if(d=document.getElementsByTagName("canvas"),j=[],d.length>0){for(b=0,c=d.length;c>b;b++)j.push(d[b]);for(b=0,c=d.length;c>b;b++)f=!1,g=!1,h=!1,-1!==j[b].className.indexOf("stack:")?(f=j[b].className.match(/stack:(\w+)/),f=f[1]):-1!==j[b].className.indexOf("lockTo:")&&(f=j[b].className.match(/lockTo:(\w+)/),f=f[1],h=!0),f&&(a.stack[f]?(a.stk[f].appendChild(j[b]),g=a.stack[f]):(i=document.createElement("div"),i.id=f,j[b].parentElement.appendChild(i),i.appendChild(j[b]),g=a.makeStack({stackElement:i}))),e=a.makePad({canvasElement:j[b]}),g&&(e.set({group:g.name,position:"absolute"}),h&&(g.set({canvas:e.name}),e.set({width:"100%",height:"100%",lockTo:g.name}))),0===b&&(a.work.currentPad=e.name);return!0}return!1},a.getElements=function(){var b,c,d,e,f,g,h=a.contains,i=a.xtGet,j=a.elementnames,k=a.stacknames,l=a.stk,m=a.makeElement;if(d=document.getElementsByClassName("scrawl"),e=[],d.length>0){for(b=0,c=d.length;c>b;b++)e.push(d[b]);for(b=0,c=d.length;c>b;b++)f=i(e.id,e.name,!1),h(j,f)||-1!==e[b].className.indexOf("stack:")&&(g=e[b].className.match(/stack:(\w+)/),h(k,g[1])&&(l[g[1]].appendChild(e[b]),m({domElement:e[b],group:g[1]})));return!0}return!1},a.addCanvasToPage=function(b){var c,d,e,f,g=a.xt,h=a.xtGet,i=Math.round;b=a.safeObject(b),b.width=h(b.width,300),b.height=h(b.height,150),g(b.stackName)&&(e=a.stack[b.stackName],e||(f=g(b.parentElement)?b.parentElement.substring?document.getElementById(b.parentElement):b.parentElement:document.body,e=a.addStackToPage({stackName:b.stackName,width:b.width,height:b.height,parentElement:f})),b.group=e.name,b.parentElement=e.name),c=document.getElementById(b.parentElement)||document.body,b.width.substring&&(b.width=i(parseFloat(b.width)/100*parseFloat(c.style.width))),b.height.substring&&(b.height=i(parseFloat(b.height)/100*parseFloat(c.style.height))),d=document.createElement("canvas"),d.style.position=h(b.position,"absolute"),c.appendChild(d),b.canvasElement=d;var j=new a.Pad(b);return a.setDisplayOffsets(),j},a.addStackToPage=function(b){var c,d,e=a.xtGet;return b.stackName.substring&&a.xt(b.parentElement)?(b.parentElement=b.parentElement.substring?document.getElementById(b.parentElement):b.parentElement,c=document.createElement("div"),c.id=b.stackName,c.style.width=e(b.width,300)+"px",c.style.height=e(b.height,150)+"px",b.parentElement.appendChild(c),b.stackElement=c,d=a.makeStack(b),d.group=a.stack[b.parentElement.id]?b.parentElement.id:"",d):!1},a.setDisplayOffsets=function(b){var c,d,e=a.stack,f=a.stacknames,g=a.pad,h=a.padnames,i=a.element,j=a.elementnames;if(b=a.xt(b)?b:"all","stack"===b||"all"===b)for(c=0,d=f.length;d>c;c++)e[f[c]].setDisplayOffsets();if("pad"===b||"all"===b)for(c=0,d=h.length;d>c;c++)g[h[c]].setDisplayOffsets();if("element"===b||"all"===b)for(c=0,d=j.length;d>c;c++)i[j[c]].setDisplayOffsets();return!0},a.setPerspectives=function(b){var c,d,e,f,g=a.stack;for(e=b?[].concat(b):a.stacknames,c=0,d=e.length;d>c;c++)f=g[e[c]],f&&(f.currentPerspective.flag=!1,f.setPerspective());return a},a.render=function(b,c){var d,e,f,g=a.pad;for(a.renderElements(),f=b?[].concat(b):a.padnames,d=0,e=f.length;e>d;d++)g[f[d]].render(c);return a},a.renderElements=function(){var b,c,d,e=a.stack,f=a.stacknames;for(b=0,c=f.length;c>b;b++)d=e[f[b]],d.group||d.render();return!0},a.domInit=function(){var b,c,d,e=a.stack,f=a.stacknames;for(b=0,c=f.length;c>b;b++)d=e[f[b]],d.group||d.domInit();return!0},a.update=function(b){var c,d,e,f=a.stack,g=a.stacknames,h=a.group;if(b=a.safeObject(b),b.group&&b.group.substring&&h[b.group]&&"ElementGroup"===h[b.group].type)h[b.group].update(b);else for(c=0,d=g.length;d>c;c++)e=f[g[c]],e.group||e.update(b);return!0},a.work.d.Device.transform=!1,a.Device.prototype.getStacksDeviceData=function(){var b=document.createElement("div");this.transform=a.xto(b.style.webkitPerspectiveOrigin,b.style.mozPerspectiveOrigin,b.style.msPerspectiveOrigin,b.style.perspectiveOrigin)},a.work.d.PageElement.start={x:0,y:0,z:0},a.work.d.PageElement.delta={x:0,y:0,z:0},a.work.d.PageElement.translate={x:0,y:0,z:0},a.work.d.PageElement.deltaTranslate={x:0,y:0,z:0},a.work.d.PageElement.handle={x:"center",y:"center",z:0},a.work.d.PageElement.pivot="",a.work.d.PageElement.group="",a.work.d.PageElement.path="",a.work.d.PageElement.pathPlace=0,a.work.d.PageElement.deltaPathPlace=0,a.work.d.PageElement.pathSpeedConstant=!0,a.work.d.PageElement.pathRoll=0,a.work.d.PageElement.addPathRoll=!1,a.work.d.PageElement.lockTo="",a.work.d.PageElement.lockX=!1,a.work.d.PageElement.lockY=!1,a.work.d.PageElement.roll=0,a.work.d.PageElement.pitch=0,a.work.d.PageElement.yaw=0,a.work.d.PageElement.deltaRoll=0,a.work.d.PageElement.deltaPitch=0,a.work.d.PageElement.deltaYaw=0,a.work.d.PageElement.rotation={n:1,v:{x:0,y:0,z:0}},a.work.d.PageElement.deltaRotation={n:1,v:{x:0,y:0,z:0}},a.work.d.PageElement.rotationTolerance=.001,a.work.d.PageElement.visibility=!0,a.work.d.PageElement.zIndexIsTranslateZ=!0,a.work.d.PageElement.viewport=!1,a.work.d.PageElement.includeCornerTrackers=!1,a.work.d.PageElement.topLeft=!1,a.work.d.PageElement.topRight=!1,a.work.d.PageElement.bottomRight=!1,a.work.d.PageElement.bottomLeft=!1,a.work.d.PageElement.topLeftDiv=!1,a.work.d.PageElement.topRightDiv=!1,a.work.d.PageElement.bottomRightDiv=!1,a.work.d.PageElement.bottomLeftDiv=!1,a.work.d.PageElement.mouseIndex="mouse",a.work.d.PageElement.order=0,a.work.d.PageElement.drag=!1,a.mergeInto(a.work.d.Pad,a.work.d.PageElement),a.PageElement.prototype.stacksPageElementConstructor=function(b){var c=a.safeObject(b.start),d=a.safeObject,e=a.makeVector,f=a.xtGet,g=a.makeQuaternion,h=a.work.d[this.type];this.start=e({name:this.type+"."+this.name+".start",x:f(b.startX,c.x,0),y:f(b.startY,c.y,0)}),this.currentStart=e({name:this.type+"."+this.name+".current.start"}),this.currentStart.flag=!1,c=d(b.delta),this.delta=e({name:this.type+"."+this.name+".delta",x:f(b.deltaX,c.x,0),y:f(b.deltaY,c.y,0)}),c=d(b.handle),this.handle=e({name:this.type+"."+this.name+".handle",x:f(b.handleX,c.x,0),y:f(b.handleY,c.y,0)}),this.currentHandle=e({name:this.type+"."+this.name+".current.handle"}),this.currentHandle.flag=!1,c=d(b.translate),this.translate=e({name:this.type+"."+this.name+".translate",x:f(b.translateX,c.x,0),y:f(b.translateY,c.y,0),z:f(b.translateZ,c.z,0)}),this.translate.flag=!1,this.translate.string="translate3d(0px,0px,0px)",this.zIndexIsTranslateZ=f(b.zIndexIsTranslateZ,!0),c=d(b.deltaTranslate),this.deltaTranslate=e({name:this.type+"."+this.name+".deltaTranslate",x:f(b.deltaTranslateX,c.x,0),y:f(b.deltaTranslateY,c.y,0),z:f(b.deltaTranslateZ,c.z,0)}),this.pivot=f(b.pivot,h.pivot),this.path=f(b.path,h.path),this.pathRoll=f(b.pathRoll,h.pathRoll),this.addPathRoll=f(b.addPathRoll,h.addPathRoll),this.pathSpeedConstant=f(b.pathSpeedConstant,h.pathSpeedConstant),this.pathPlace=f(b.pathPlace,h.pathPlace),this.deltaPathPlace=f(b.deltaPathPlace,h.deltaPathPlace),this.lockX=f(b.lockX,h.lockX),this.lockY=f(b.lockY,h.lockY),this.lockTo=f(b.lockTo,h.lockTo),this.scale=f(b.scale,1),this.viewport=f(b.viewport,!1),this.visibility=f(b.visibility,h.visibility),this.pitch=b.pitch||0,this.yaw=b.yaw||0,this.roll=b.roll||0,this.rotation=g({name:this.type+"."+this.name+".rotation"}).setFromEuler({pitch:this.pitch,yaw:this.yaw,roll:this.roll}),this.rotation.flag=!1,this.rotation.string="rotate3d(0,0,0,0rad)",this.deltaPitch=b.deltaPitch||0,this.deltaYaw=b.deltaYaw||0,this.deltaRoll=b.deltaRoll||0,this.deltaRotation=g({name:this.type+"."+this.name+".deltaRotation"}).setFromEuler({pitch:this.deltaPitch,yaw:this.deltaYaw,roll:this.deltaRoll}),this.rotationTolerance=f(b.rotationTolerance,h.rotationTolerance),this.group=f(b.group,!1),this.group&&a.group[this.group].addElementsToGroup(this.name),this.includeCornerTrackers=f(b.includeCornerTrackers,!1),this.includeCornerTrackers&&this.addCornerTrackers(),this.mouseIndex=f(b.mouseIndex,"mouse"),this.order=f(b.order,0),this.drag=f(b.drag,!1)},a.PageElement.prototype.addCornerTrackers=function(){var b,c,d=["topLeft","topRight","bottomRight","bottomLeft"],e=this.getElement();for(c=0;4>c;c++){switch(this[d[c]]=a.makeVector({name:this.name+".cornerTracker."+d[c]}),b=document.createElement("div"),b.id=this.name+"_"+d[c],b.style.width=0,b.style.height=0,b.style.margin=0,b.style.border=0,b.style.padding=0,b.style.position="absolute",d[c]){case"topLeft":b.style.top=0,b.style.left=0;break;case"topRight":b.style.top=0,b.style.right=0;break;case"bottomRight":b.style.bottom=0,b.style.right=0;break;case"bottomLeft":b.style.bottom=0,b.style.left=0}e.appendChild(b),this[d[c]+"Div"]=b}return this.updateCornerTrackers(),this},a.PageElement.prototype.updateCornerTrackers=function(){var b,c,d,e,f,g,h,i,j=["topLeft","topRight","bottomRight","bottomLeft"];if(b=this.getElement(),f=a.stk[a.group[this.group].stack])for(g=f.getBoundingClientRect(),h=parseInt(g.left,10),i=parseInt(g.top,10),e=0;4>e;e++)this[j[e]]&&this[j[e]+"Div"]&&(b=this[j[e]+"Div"].getBoundingClientRect(),d=parseInt(b.left,10),c=parseInt(b.top,10),this[j[e]].x=d-h,this[j[e]].y=c-i);return this},a.PageElement.prototype.get=function(b){var c,d=["width","height"],e=["startX","startY","handleX","handleY","deltaX","deltaY","translateX","translateY","translateZ","deltaTranslateX","deltaTranslateY","deltaTranslateZ"],f=a.contains;if(c=this.getElement(),f(d,b))switch(this.type){case"Pad":if("width"===b)return this.localWidth||this.width||parseFloat(c.width)||a.work.d[this.type].width;if("height"===b)return this.localHeight||this.height||parseFloat(c.height)||a.work.d[this.type].height;break;default:if("width"===b)return this.localWidth||this.width||parseFloat(c.style.width)||parseFloat(c.clientWidth)||a.work.d[this.type].width;if("height"===b)return this.localHeight||this.height||parseFloat(c.style.height)||parseFloat(c.clientHeight)||a.work.d[this.type].height}if(f(e,b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y;case"deltaX":return this.delta.x;case"deltaY":return this.delta.y;case"translateX":return this.translate.x;case"translateY":return this.translate.y;case"translateZ":return this.translate.z;case"deltaTranslateX":return this.deltaTranslate.x;case"deltaTranslateY":return this.deltaTranslate.y;case"deltaTranslateZ":return this.deltaTranslate.z}return a.xt(c.style[b])?c.style[b]:a.Base.prototype.get.call(this,b)},a.PageElement.prototype.set=function(b){var c=a.xt,d=a.xto;return b=a.safeObject(b),a.Base.prototype.set.call(this,b),d(b.start,b.startX,b.startY)&&this.setStart(b),d(b.handle,b.handleX,b.handleY)&&this.setHandle(b),d(b.delta,b.deltaX,b.deltaY)&&this.setDeltaAttribute(this),d(b.translate,b.translateX,b.translateY,b.translateZ)&&this.setTranslate(b),d(b.deltaTranslate,b.deltaTranslateX,b.deltaTranslateY,b.deltaTranslateZ)&&this.setDeltaTranslate(b),d(b.pitch,b.yaw,b.roll)&&this.setRotation(b),d(b.deltaPitch,b.deltaYaw,b.deltaRoll)&&this.setDeltaRotation(b),c(b.includeCornerTrackers)&&(this.includeCornerTrackers=b.includeCornerTrackers,this.topLeftDiv||this.addCornerTrackers()),d(b.width,b.height,b.scale,b.border,b.borderLeft,b.borderRight,b.borderTop,b.borderBottom,b.borderWidth,b.borderLeftWidth,b.borderRightWidth,b.borderTopWidth,b.borderBottomWidth,b.padding,b.paddingLeft,b.paddingRight,b.paddingTop,b.paddingBottom,b.boxSizing,b.lockTo)&&(a.group[this.group]&&a.group[this.group].checkEqualDimensions()&&(a.group[this.group].recalculateDimensions=!0),this.setLocalDimensions(),this.setDimensions()),d(b.handleX,b.handleY,b.handle,b.width,b.height,b.scale,b.border,b.borderLeft,b.borderRight,b.borderTop,b.borderBottom,b.borderWidth,b.borderLeftWidth,b.borderRightWidth,b.borderTopWidth,b.borderBottomWidth,b.padding,b.paddingLeft,b.paddingRight,b.paddingTop,b.paddingBottom,b.boxSizing,b.lockTo)&&(this.currentHandle.flag=!1),d(b.handleX,b.handleY,b.handle,b.width,b.height,b.scale,b.startX,b.startY,b.start,b.border,b.borderLeft,b.borderRight,b.borderTop,b.borderBottom,b.borderWidth,b.borderLeftWidth,b.borderRightWidth,b.borderTopWidth,b.borderBottomWidth,b.padding,b.paddingLeft,b.paddingRight,b.paddingTop,b.paddingBottom,b.boxSizing,b.lockTo)&&this.setDisplayOffsets(),d(b.handleX,b.handleY,b.handle)&&this.setTransformOrigin(),c(b.group)&&this.setGroupAttribute(b),c(b.pivot)&&this.setPivotAttribute(b),c(b.drag)&&(this.drag=b.drag),c(b.order)&&(this.order=b.order),d(b.title,b.comment)&&this.setAccessibility(b),c(b.interactive)&&(this.interactive=b.interactive,this.removeMouseMove(),this.interactive&&this.addMouseMove()),this.setStyles(b),this},a.PageElement.prototype.setStart=function(b){var c,d=a.safeObject,e=a.xtGet,f=a.makeVector,g=a.isa_vector;return b=d(b),g(this.start)||(this.start=f(b.start||this.start),this.start.name=this.type+"."+this.name+".start"),c=d(b.start),this.start.x=e(b.startX,c.x,this.start.x),this.start.y=e(b.startY,c.y,this.start.y),g(this.currentStart)||(this.currentStart=f({name:this.type+"."+this.name+".current.start"})),this.currentStart.flag=!1,this},a.PageElement.prototype.setHandle=function(b){var c,d=a.safeObject,e=a.xtGet,f=a.makeVector,g=a.isa_vector;return b=d(b),g(this.handle)||(this.handle=f(b.handle||this.handle),this.handle.name=this.type+"."+this.name+".handle"),c=d(b.handle),this.handle.x=e(b.handleX,c.x,this.handle.x),this.handle.y=e(b.handleY,c.y,this.handle.y),g(this.currentHandle)||(this.currentHandle=f({name:this.type+"."+this.name+".current.handle"})),this.currentHandle.flag=!1,this},a.PageElement.prototype.setDeltaAttribute=function(b){var c,d=a.safeObject,e=a.xtGet;return b=d(b),a.isa_vector(this.delta)||(this.delta=a.makeVector(b.delta||this.delta)),c=d(b.delta),this.delta.x=e(b.deltaX,c.x,this.delta.x),this.delta.y=e(b.deltaY,c.y,this.delta.y),this},a.PageElement.prototype.setPivotAttribute=function(a){return this.pivot=a.pivot,this.pivot||(delete this.oldX,delete this.oldY),this},a.PageElement.prototype.setGroupAttribute=function(b){var c,d,e,f=a.group,g=a.groupnames,h=a.contains;for(d=0,e=g.length;e>d;d++)c=f[g[d]],"ElementGroup"===c.type&&(g[d]===b.group?c.addElementsToGroup(this.name):h(c.elements,this.name)&&c.removeElementsFromGroup(this.name));return this},a.PageElement.prototype.setRotation=function(a){return this.rotation.setFromEuler({pitch:a.pitch||0,yaw:a.yaw||0,roll:a.roll||0}),this.rotation.flag=!1,this},a.PageElement.prototype.setDeltaRotation=function(a){return this.deltaRotation.setFromEuler({pitch:a.deltaPitch||0,yaw:a.deltaYaw||0,roll:a.deltaRoll||0}),this},a.PageElement.prototype.setTranslate=function(b){var c,d,e=a.xtGet;return b=a.safeObject(b),this.translate.type&&"Vector"===this.translate.type||(this.translate=a.makeVector(b.translate||this.translate)),c=a.safeObject(b.translate),d=this.translate,d.x=e(b.translateX,c.x,d.x),d.y=e(b.translateY,c.y,d.y),d.z=e(b.translateZ,c.z,d.z),this.translate.flag=!1,this},a.PageElement.prototype.setDeltaTranslate=function(b){var c,d,e=a.xtGet;return b=a.safeObject(b),this.deltaTranslate.type&&"Vector"===this.deltaTranslate.type||(this.deltaTranslate=a.makeVector(b.deltaTranslate||this.deltaTranslate)),c=a.safeObject(b.deltaTranslate),d=this.deltaTranslate,d.x=e(b.deltaTranslateX,c.x,d.x),d.y=e(b.deltaTranslateY,c.y,d.y),d.z=e(b.deltaTranslateZ,c.z,d.z),this},a.PageElement.prototype.setStyles=function(b){var c,d,e,f,g,h,i,j=["hidden","none"],k=a.contains;for(b=a.safeObject(b),c=this.getElement(),d=Object.keys(b),e=0,f=d.length;f>e;e++)g=d[e],"visibility"===g?(this.visibility=b.visibility.substring?k(j,b.visibility)?!1:!0:b.visibility?!0:!1,this.group?c.style.opacity=this.visibility?1:0:c.style.display=this.visibility?"block":"none"):"zIndex"!==g||this.zIndexIsTranslateZ?k(a.work.xcss,g)?(h=g[0].toUpperCase,i=g.substr(1),c.style["webkit"+h+i]=b[g],c.style["moz"+h+i]=b[g],c.style["ms"+h+i]=b[g],c.style["o"+h+i]=b[g],c.style[g]=b[g]):k(a.work.css,g)&&(c.style[g]=b[g]):c.style.zIndex=b[g];return this},a.PageElement.prototype.addClass=function(a){var b;return a.substring?(b=this.getElement(),0===b.className.length?b.className=a:b.className+=" "===b.className[b.className.length-1]?a:" "+a,this):void 0},a.PageElement.prototype.removeClass=function(a){var b,c,d,e,f,g;if(a.substring){for(b=this.getElement(),d=b.className,c=a.split(),f=0,g=c.length;g>f;f++)e=new RegExp(" ?"+c[f]+" ?"),d=d.replace(e," ");b.className=d}return this},a.PageElement.prototype.setDelta=function(b){var c,d,e=a.xto,f=this.translate,g=this.deltaTranslate,h=a.work.workquat.q1;return b=a.safeObject(b),e(b.start,b.startX,b.startY)&&this.setDeltaStart(b),e(b.handle,b.handleX,b.handleY)&&this.setDeltaHandle(b),e(b.translate,b.translateX,b.translateY)&&(c=a.safeObject(b.translate),f.x+=a.xtGet(b.translateX,c.x,0),f.y+=a.xtGet(b.translateY,c.y,0),f.z+=a.xtGet(b.translateZ,c.z,0),this.translate.flag=!1),e(b.deltaTranslate,b.deltaTranslateX,b.deltaTranslateY)&&(c=a.isa_obj(b.deltaTranslate)?b.deltaTranslate:{},g.x+=a.xtGet(b.deltaTranslateX,c.x,0),g.y+=a.xtGet(b.deltaTranslateY,c.y,0),g.z+=a.xtGet(tems.deltaTranslateZ,c.z,0)),e(b.pitch,b.yaw,b.roll)&&(c=h.setFromEuler({pitch:b.pitch||0,yaw:b.yaw||0,roll:b.roll||0}),this.rotation.quaternionMultiply(c),this.rotation.flag=!1),e(b.deltaPitch,b.deltaYaw,b.deltaRoll)&&(c=h.setFromEuler({pitch:b.deltaPitch||0,yaw:b.deltaYaw||0,roll:b.deltaRoll||0}),this.deltaRotation.quaternionMultiply(c)),e(b.handleX,b.handleY,b.handle,b.width,b.height,b.scale)&&(this.currentHandle.flag=!1),e(b.handleX,b.handleY,b.handle,b.width,b.height,b.scale,b.startX,b.startY,b.start)&&this.setDisplayOffsets(),e(b.handleX,b.handleY,b.handle)&&this.setTransformOrigin(),e(b.width,b.height,b.scale)&&(d=a.group[this.group],d&&d.checkEqualDimensions()&&(d.recalculateDimensions=!0),this.setLocalDimensions(),this.setDimensions()),this},a.PageElement.prototype.setDeltaStart=function(b){var c,d,e,f=a.safeObject,g=a.xtGet,h=a.addPercentages;return b=f(b),c=f(b.start),d=g(b.startX,c.x,0),e=g(b.startY,c.y,0),this.start.x=this.start.x.toFixed?this.start.x+d:h(this.start.x,d),this.start.y=this.start.y.toFixed?this.start.y+e:h(this.start.y,e),this.currentStart.flag=!1,this},a.PageElement.prototype.setDeltaHandle=function(b){var c,d,e,f=a.safeObject,g=a.xtGet,h=a.addPercentages;return b=f(b),c=f(b.handle),d=g(b.handleX,c.x,0),e=g(b.handleY,c.y,0),this.handle.x=this.handle.x.toFixed?this.handle.x+d:h(this.handle.x,d),this.handle.y=this.handle.y.toFixed?this.handle.y+e:h(this.handle.y,e),this.currentHandle.flag=!1,this},a.PageElement.prototype.updateStart=function(b){return b=a.xtGet(b,"all"),this.updateStartActions[b](a.addPercentages,this.start,this.delta,a.addWithinBounds,this),this.currentStart.flag=!1,a.xt(this.collisionArray)&&(this.collisionArray.length=0),this.setDisplayOffsets(),this},a.PageElement.prototype.updateStartActions={x:function(a,b,c){b.x=b.x.toFixed?b.x+c.x:a(b.x,c.x)},y:function(a,b,c){b.y=b.y.toFixed?b.y+c.y:a(b.y,c.y)},path:function(a,b,c,d,e){e.pathPlace=d(e.pathPlace,e.deltaPathPlace)},all:function(a,b,c,d,e){e.deltaPathPlace&&(e.pathPlace=d(e.pathPlace,e.deltaPathPlace)),c.x&&(b.x=b.x.toFixed?b.x+c.x:a(b.x,c.x)),c.y&&(b.y=b.y.toFixed?b.y+c.y:a(b.y,c.y))}},a.PageElement.prototype.revertStart=function(b){return b=a.xtGet(b,"all"),this.revertStartActions[b](a.subtractPercentages,this.start,this.delta,a.addWithinBounds,this),this.currentStart.flag=!1,a.xt(this.collisionArray)&&(this.collisionArray.length=0),this.setDisplayOffsets(),this},a.PageElement.prototype.revertStartActions={x:function(a,b,c){b.x=b.x.toFixed?b.x-c.x:a(b.x,c.x)},y:function(a,b,c){b.y=b.y.toFixed?b.y-c.y:a(b.y,c.y)},path:function(a,b,c,d,e){e.pathPlace=d(e.pathPlace,-e.deltaPathPlace)},all:function(a,b,c,d,e){e.deltaPathPlace&&(e.pathPlace=d(e.pathPlace,-e.deltaPathPlace)),c.x&&(b.x=b.x.toFixed?b.x-c.x:a(b.x,c.x)),c.y&&(b.y=b.y.toFixed?b.y-c.y:a(b.y,c.y))}},a.PageElement.prototype.exchange=function(b,c){var d;return a.isa_obj(b)&&(d=this[c]||this.get(c),this[c]=b[c]||b.get(c),b[c]=d,this.setDisplayOffsets()),this},a.PageElement.prototype.reverse=function(b){return b=a.xtGet(b,"all"),this.reverseActions[b](this.delta,a.reversePercentage,this),this.setDisplayOffsets(),this},a.PageElement.prototype.reverseActions={deltaX:function(a,b){a.x=a.x.toFixed?-a.x:b(a.x)},deltaY:function(a,b){a.y=a.y.toFixed?-a.y:b(a.y)},delta:function(a,b){a.x=a.x.toFixed?-a.x:b(a.x),a.y=a.y.toFixed?-a.y:b(a.y)},deltaPathPlace:function(a,b,c){c.deltaPathPlace=-c.deltaPathPlace},all:function(a,b,c){c.deltaPathPlace=-c.deltaPathPlace,a.x=a.x.toFixed?-a.x:b(a.x),a.y=a.y.toFixed?-a.y:b(a.y)}},a.PageElement.prototype.update3d=function(b){var c=this.rotation,d=this.translate;return b=a.safeObject(b),a.isa_quaternion(b.quaternion)?(c.set(this.deltaRotation),c.quaternionRotate(b.quaternion),d.zero(),d.vectorAdd(this.deltaTranslate),d.rotate3d(b.quaternion,b.distance)):(c.quaternionRotate(this.deltaRotation),d.vectorAdd(this.deltaTranslate)),this.translate.flag=!1,this.rotation.flag=!1,this},a.PageElement.prototype.renderElement=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=!1;if(c=a.group[this.group],l=this.getElement().style,this.currentHandle.flag||this.updateCurrentHandle(),!this.currentStart.flag&&c.stack&&(this.updateCurrentStart(a.stack[c.stack]),(c.equalWidth||c.equalHeight)&&this.setDimensions(),o=!0),this.path?(this.setStampUsingPath(),o=!0):this.pivot&&(this.setStampUsingPivot(),o=!0),(this.viewport||this.topLeft)&&(o=!0),!this.translate.flag||!this.rotation.flag){if(i=this.rotation,m=this.translate,m.flag||(b=[0,0,0],h=Math.round,k=this.scale,b[0]=h(m.x*k),b[1]=h(m.y*k),b[2]=h(m.z*k),this.zIndexIsTranslateZ&&(l.zIndex=b[2]),m.string="translate3d("+b[0]+"px,"+b[1]+"px,"+b[2]+"px)",m.flag=!0),!i.flag){for(b=[0,0,0,0],1!==i.getMagnitude()&&i.normalize(),j=i.v,b[0]=j.x,b[1]=j.y,b[2]=j.z,b[3]=i.getAngle(!1),d=0;4>d;d++)b[d]<1e-6&&b[d]>-1e-6&&(b[d]=0);i.string="rotate3d("+b[0]+","+b[1]+","+b[2]+","+b[3]+"rad)",i.flag=!0}n=m.string+" "+i.string,l.webkitTransform=n,l.transform=n}return o&&(f=this.currentStart,e=this.currentHandle,this.viewport?(g=a.device,n=g.offsetX-this.displayOffsetX+e.x+f.x+"px",l.left=n,n=g.offsetY-this.displayOffsetY+e.y+f.y+"px",l.top=n):(n=f.x+e.x+"px",l.left=n,n=f.y+e.y+"px",l.top=n),this.topLeft&&this.updateCornerTrackers()),this},a.PageElement.prototype.getReferenceDimensions={Stack:function(a){return{w:a.localWidth,h:a.localHeight}},Pad:function(a){return{w:a.localWidth,h:a.localHeight}},Element:function(a){return{w:a.localWidth,h:a.localHeight}}},a.PageElement.prototype.updateCurrentHandle=function(){var b,c,d,e,f,g,h,i;return this.currentHandle.flag||(b=this.getReferenceDimensions[this.type](this),c=a.contains,d=this.numberConvert,e=this.handle,f=["top","bottom","left","right","center"],g=e.x.substring,h=e.y.substring,i=this.currentHandle,i.x=g?d(e.x,b.w):e.x,i.y=h?d(e.y,b.h):e.y,isNaN(i.x)&&(i.x=0),isNaN(i.y)&&(i.y=0),i.reverse(),i.flag=!0),this},a.PageElement.prototype.updateCurrentStart=function(b){var c,d,e,f,g;if(!this.currentStart.flag&&b&&b.type){if(f=this.currentStart,this.viewport?(g=a.device,c={w:g.width,h:g.height}):c=this.getReferenceDimensions[b.type](b),d=this.numberConvert,e=this.start,f.x=e.x.substring?d(e.x,c.w):e.x,f.y=e.y.substring?d(e.y,c.h):e.y,isNaN(f.x)||isNaN(f.y))return f.x=0,f.y=0,this;f.flag=!0}return this},a.PageElement.prototype.setStampUsingPath=function(){var b,c=a.entity[this.path],d=this.start;return c&&"Path"===c.type&&(b=c.getPerimeterPosition(this.pathPlace,this.pathSpeedConstant,this.addPathRoll),b&&(d.x=this.lockX?d.x:b.x,d.y=this.lockY?d.y:b.y,this.pathRoll=b.r||0,this.addPathRoll&&(this.rotation.setFromEuler({pitch:this.pitch,yaw:this.yaw,roll:this.pathRoll+this.roll}),this.rotation.flag=!1))),this},a.Position.prototype.setStampUsingPivotCalculations.stack=function(a,b){a.lockTo?a.setStampUsingLockTo(b):a.setStampUsingDomElementPivot(a,b)},a.PageElement.prototype.setStampUsingPivot=a.Position.prototype.setStampUsingPivot,a.PageElement.prototype.setStampUsingPivotCalculations={},a.PageElement.prototype.setStampUsingPivotCalculations.point=a.Position.prototype.setStampUsingPivotCalculations.point,a.PageElement.prototype.setStampUsingPivotCalculations.entity=a.Position.prototype.setStampUsingPivotCalculations.entity,a.PageElement.prototype.setStampUsingPivotCalculations.stack=a.Position.prototype.setStampUsingPivotCalculations.stack,a.PageElement.prototype.setStampUsingPivotCalculations.mouse=function(b,c,d,e){var f,g=b.currentStart;a.xt(e)||(f=a.stack[a.group[b.group].stack],e=f.mice[b.mouseIndex]||{x:0,y:0}),e&&(null==b.oldX&&null==b.oldY&&(b.oldX=g.x,b.oldY=g.y),g.x=b.lockX?g.x:g.x+e.x-b.oldX,g.y=b.lockY?g.y:g.y+e.y-b.oldY,b.oldX=e.x,b.oldY=e.y)},a.PageElement.prototype.setStampUsingDomElementPivot=function(a,b){var c=b.currentStart,d=a.currentStart;d.x=a.lockX?d.x:c.x,d.y=a.lockY?d.y:c.y},a.Position.prototype.setStampUsingDomElementPivot=a.PageElement.prototype.setStampUsingDomElementPivot,a.PageElement.prototype.setStampUsingLockTo=function(b){var c,d,e,f=b.currentStart,g=b.currentHandle,h=this.currentStart;if(f.flag||b.setStart(),g.flag||b.setHandle(),d=f.x+g.x,e=f.y+g.y,this.lockTo)switch(b.setLocalDimensions(),c=a.group[this.group],this.lockTo){case"bottom":e+=c.equalHeight?c.currentHeight:b.localHeight;break;case"right":d+=c.equalWidth?c.currentWidth:b.localWidth;break;case"left":d-=c.equalWidth?c.currentWidth:this.localWidth;break;case"top":e-=c.equalHeight?c.currentHeight:this.localHeight}h.x=d,h.y=e},a.PageElement.prototype.setTransformOrigin=function(){var a,b,c,d,e,f,g;return a=this.getElement(),a&&(g=a.style,e=this.handle,f=this.scale,c=e.x.substring?e.x:e.x*f+"px",d=e.y.substring?e.y:e.y*f+"px",b=c+" "+d,g.mozTransformOrigin=b,g.webkitTransformOrigin=b,g.msTransformOrigin=b,g.oTransformOrigin=b,g.transformOrigin=b),this},a.PageElement.prototype.setDisplayOffsets=function(){var a,b,c;if(a=0,b=0,this.viewport&&this.setLocalDimensions(),c=this.getElement(),c.offsetParent)do this.viewport&&this.name==c.id||(a+=c.offsetLeft,b+=c.offsetTop),c=c.offsetParent;while(c.offsetParent);return this.displayOffsetX=a,this.displayOffsetY=b,this},a.PageElement.prototype.setLocalDimensions=function(){var b,c,d,e,f,g,h,i,j,k,l=this.scale;return f=a.xt(a.group[this.group])?a.stack[a.group[this.group].stack]:!1,this.viewport?(c=a.device.width,b=a.device.height):f&&(c=f.localWidth,b=f.localHeight),g=this.getElement(),g&&(k=g.style,j=window.getComputedStyle(g,null)),e=parseFloat(this.width),0===e||isNaN(e)?g&&(k.width="auto",this.localWidth=parseFloat(j.getPropertyValue("width"))):(this.viewport||f)&&a.isa(this.width,"str")&&c?(h=this.width.match(/^-?\d+\.?\d*(\D*)/),i=h[1],this.localWidth="%"===i?parseFloat(this.width)/100*c*l:parseFloat(this.width)*l):this.localWidth=parseFloat(this.width)*l,d=parseFloat(this.height),0===d||isNaN(d)?g&&(k.height="auto",this.localHeight=parseFloat(j.getPropertyValue("height"))):(this.viewport||f)&&a.isa(this.height,"str")&&b?(h=this.height.match(/^-?\d+\.?\d*(\D*)/),i=h[1],this.localHeight="%"===i?parseFloat(this.height)/100*b*l:parseFloat(this.height)*l):this.localHeight=parseFloat(this.height)*l,this.viewport&&this.setDimensions(),"Pad"===this.type&&this.setCellLocalDimensions(),this
},a.PageElement.prototype.setDimensions=function(){var b,c,d,e,f;return e=this.getElement(),e&&(f=e.style,d=a.group[this.group],c=d&&d.equalWidth?d.currentWidth:this.localWidth,b=d&&d.equalHeight?d.currentHeight:this.localHeight,f.width=c+"px",f.height=b+"px"),this},a.PageElement.prototype.domInitialize=function(){var b=this.start,c=this.handle,d=a.work.d[this.type];return this.set({startX:b.x||0,startY:b.y||0,handleX:c.x||0,handleY:c.y||0,width:this.width||d.width,height:this.height||d.height,scale:this.scale||1}),this},a.PageElement.prototype.pickupEntity=function(b){var c;return b=a.safeObject(b),c=a.work.v.set(b),this.oldX=c.x||0,this.oldY=c.y||0,this.oldPivot=this.pivot,this.mouseIndex=a.xtGet(b.id||"mouse"),this.pivot="mouse",this.order+=9999,a.group[this.group].resort=!0,this},a.PageElement.prototype.dropEntity=function(b){return this.pivot=a.xtGet(b,this.oldPivot,null),this.order=this.order>=9999?this.order-9999:0,delete this.oldPivot,delete this.oldX,delete this.oldY,this.mouseIndex="mouse",a.group[this.group].resort=!0,this.start.x=this.currentStart.x,this.start.y=this.currentStart.y,this.currentHandle.flag=!1,this.setPaste&&this.setPaste(),this},a.Pad.prototype.setDimensions=function(){var b,c,d,e;return e=this.getElement(),e&&(d=a.group[this.group],c=d&&d.equalWidth?d.currentWidth:this.localWidth,b=d&&d.equalHeight?d.currentHeight:this.localHeight,e.width=c,e.height=b),this},a.newStack=function(b){return a.makeStack(b)},a.newElement=function(b){return a.makeElement(b)},a.newElementGroup=function(b){return a.makeElementGroup(b)},a.makeStack=function(b){return new a.Stack(b)},a.makeElement=function(b){return new a.Element(b)},a.makeElementGroup=function(b){return new a.ElementGroup(b)},a.pushUnique(a.work.sectionlist,"stack"),a.pushUnique(a.work.sectionlist,"stk"),a.pushUnique(a.work.nameslist,"stacknames"),a.Pad.prototype.padStacksConstructor=function(a){this.setStyles(a),this.setTransformOrigin()},a.Pad.prototype.padStacksSet=function(b){var c;b=a.safeObject(b),this.lockTo&&a.xto(b.width,b.height,b.scale)&&this.setLocalDimensions(),this.group&&(c=a.canvas[this.name].style,c.margin="0",c.webkitBoxSizing="border-box",c.mozBoxSizing="border-box",c.boxSizing="border-box")},a.Pad.prototype.setCellLocalDimensions=function(){var b,c,d,e=a.cell,f=this.cells;if(a.xt(f))for(b=0,c=f.length;c>b;b++)d=e[f[b]],this.lockTo&&d.name===this.base&&d.set({width:this.localWidth,height:this.localHeight}),d.name===this.display&&d.set({width:this.localWidth,height:this.localHeight})},a.Position.prototype.setStampUsingStacksPivot=function(){var b,c,d;return b=a.element[this.pivot]||a.stack[this.pivot]||a.pad[this.pivot]||!1,b?(c=b.currentStart,d=this.currentStart,this.lockX||(d.x=c.x),this.lockY||(d.y=c.y),this):void 0},a.Stack=function(b){var c,d,e,f=a.makeVector,g=a.xtGet;return b=a.safeObject(b),a.xt(b.stackElement)?(b.width=g(b.width,b.stackElement.style.width,a.work.d.Stack.width),b.height=g(b.height,b.stackElement.style.height,a.work.d.Stack.height),b.name=g(b.stackName,b.name,b.stackElement.id,b.stackElement.name,"Stack"),a.PageElement.call(this,b),this.name.match(/~~~/)&&(this.name=this.name.replace(/~~~/g,"_")),d=this.name,b.stackElement.id=d,b.stackElement.style.position="relative",a.stack[d]=this,a.stk[d]=b.stackElement,a.pushUnique(a.stacknames,d),this.setDisplayOffsets(),this.setAccessibility(b),c=a.safeObject(b.perspective),this.perspective=f({name:this.type+"."+d+".perspective",x:g(b.perspectiveX,c.x,"center"),y:g(b.perspectiveY,c.y,"center"),z:g(b.perspectiveZ,c.z,0)}),this.currentPerspective=f({name:this.type+"."+d+".current.perspective"}),this.currentPerspective.flag=!1,this.groups=[d],a.makeElementGroup({name:d,stack:d}),this.group=g(b.group,!1),this.group&&a.group[this.group].addElementsToGroup(d),this.setStyles(b),this.setPerspective(),this.setTransformOrigin(),this.group&&(e=a.stk[d].style,e.margin="0",e.webkitBoxSizing="border-box",e.mozBoxSizing="border-box",e.boxSizing="border-box",b.stackElement.style.position="absolute"),this.interactive=g(b.interactive,!0),this.interactive&&this.addMouseMove(),this):!1},a.Stack.prototype=Object.create(a.PageElement.prototype),a.Stack.prototype.type="Stack",a.Stack.prototype.classname="stacknames",a.work.d.Stack={perspective:{x:"center",y:"center",z:0},currentPerspective:{x:0,y:0,z:0},canvas:"",groups:[]},a.mergeInto(a.work.d.Stack,a.work.d.PageElement),a.Stack.prototype.getElement=function(){return a.stk[this.name]},a.Stack.prototype.set=function(b){{var c,d,e,f=a.safeObject,g=a.xtGet,h=(a.xt,a.xto),i=a.group;a.stack}return b=f(b),a.PageElement.prototype.set.call(this,b),e=i[this.name],h(b.width,b.height,b.scale,b.perspective,b.perspectiveX,b.perspectiveY,b.perspectiveZ)&&(h(b.perspective,b.perspectiveX,b.perspectiveY,b.perspectiveZ)&&(d=this.perspective,c=f(b.perspective),d.x=g(b.perspectiveX,c.x,d.x),d.y=g(b.perspectiveY,c.y,d.y),d.z=g(b.perspectiveZ,c.z,d.z),this.currentPerspective.flag=!1),this.setPerspective()),h(b.start,b.startX,b.startY,b.width,b.height,b.scale)&&(e?e.setDirtyStarts():this.currentStart=!1),h(b.handle,b.handleX,b.handleY,b.width,b.height,b.scale)&&(e?e.setDirtyHandles():this.currentHandle=!1),h(b.width,b.height,b.scale)&&e&&e.updateDimensions(),this},a.Stack.prototype.setDelta=function(b){{var c,d,e,f,g,h=a.addPercentages,i=a.safeObject,j=a.xtGet,k=(a.xt,a.xto),l=a.group;a.stack}return b=i(b),a.PageElement.prototype.setDelta.call(this,b),g=l[this.name],k(b.width,b.height,b.scale,b.perspective,b.perspectiveX,b.perspectiveY,b.perspectiveZ)&&(k(b.perspective,b.perspectiveX,b.perspectiveY,b.perspectiveZ)&&(f=this.perspective,c=i(b.perspective),d=j(b.perspectiveX,c.x,0),e=j(b.perspectiveY,c.y,0),f.x=f.x.substring?h(f.x,d):f.x+d,f.y=f.y.substring?h(f.y,e):f.y+e,f.z+=j(b.perspectiveZ,c.z,0),this.currentPerspective.flag=!1),this.setPerspective()),k(b.start,b.startX,b.startY,b.width,b.height,b.scale)&&(g?g.setDirtyStarts():this.currentStart=!1),k(b.handle,b.handleX,b.handleY,b.width,b.height,b.scale)&&(g?g.setDirtyHandles():this.currentHandle=!1),k(b.width,b.height,b.scale)&&g&&g.updateDimensions(),this},a.Stack.prototype.setLocalDimensions=function(){var b,c,d,e,f,g,h,i,j;return f=a.xt(a.group[this.group])?a.stack[a.group[this.group].stack]:!1,f&&(c=f.localWidth,b=f.localHeight),e=parseFloat(this.width),d=parseFloat(this.height),(0===e||isNaN(e)||0===d||isNaN(d))&&(i=a.group[this.name],i?j=i.getElementGroupDimensions():(g=this.getElement(),g&&(h=window.getComputedStyle(g,null)))),0===e||isNaN(e)?j?this.localWidth=j.width:h?(g.style.width="auto",this.localWidth=parseFloat(h.getPropertyValue("width"))):this.localWidth=0:this.localWidth=f&&this.width.substring&&c?parseFloat(this.width)/100*c*this.scale:this.width*this.scale,0===d||isNaN(d)?j?this.localHeight=j.height:h?(g.style.height="auto",this.localHeight=parseFloat(h.getPropertyValue("height"))):this.localHeight=0:this.localHeight=f&&this.height.substring&&b?parseFloat(this.height)/100*b*this.scale:this.height*this.scale,this},a.Stack.prototype.addElementById=function(b){if(b.substring){var c=a.makeElement({domElement:document.getElementById(b),group:this.name});return a.stk[this.name].appendChild(a.elm[c.name]),a.elm[c.name]=document.getElementById(c.name),c}return!1},a.Stack.prototype.addElementsByClassName=function(b){var c,d,e,f,g,h=[];if(b.substring){for(c=document.getElementsByClassName(b),f=0,g=c.length;g>f;f++)e=c[f],"CANVAS"!==e.nodeName&&(d=a.makeElement({domElement:e,group:this.name}),h.push(d));for(f=0,g=h.length;g>f;f++)a.stk[this.name].appendChild(a.elm[h[f].name]),a.elm[h[f].name]=document.getElementById(h[f].name);return h}return!1},a.Stack.prototype.render=function(){for(var b=a.group,c=this.groups,d=0,e=c.length;e>d;d++)b[c[d]].render();return!0},a.Stack.prototype.domInit=function(){for(var b=a.group,c=this.groups,d=0,e=c.length;e>d;d++)b[c[d]].domInit();return!0},a.Stack.prototype.update=function(){for(var b=a.group,c=this.groups,d=0,e=c.length;e>d;d++)b[c[d]].update();return!0},a.Stack.prototype.renderPads=function(){for(var b=a.group,c=this.groups,d=0,e=c.length;e>d;d++)b[c[d]].renderPads();return!0},a.Stack.prototype.setPerspective=function(){var a,b,c,d,e,f,g,h,i=this.perspective,j=this.currentPerspective,k=this.scale;c=i.x.substring?k:1,d=i.y.substring?k:1,j.flag||this.setCurrentPerspective(),e=this.getElement(),f=e.style,a=j.x*c,b=j.y*d,g=a+"px "+b+"px",h=j.z+"px",f.mozPerspectiveOrigin=g,f.webkitPerspectiveOrigin=g,f.perspectiveOrigin=g,f.mozPerspective=h,f.webkitPerspective=h,f.perspective=h},a.Stack.prototype.setCurrentPerspective=function(){var b=this.perspective,c=this.currentPerspective,d=(this.group?a.stack[a.group[this.group].stack]:this,this.numberConvert);return c.x=b.x.substring?d(b.x,this.localWidth):b.x,c.y=b.y.substring?d(b.y,this.localHeight):b.y,c.z=b.z,c.flag=!0,this},a.pushUnique(a.work.sectionlist,"element"),a.pushUnique(a.work.sectionlist,"elm"),a.pushUnique(a.work.nameslist,"elementnames"),a.Stack.prototype.getStackDimensions=function(){var b=a.group[this.name];return b?b.getElementGroupDimensions():a.work.o},a.Element=function(b){var c,d=a.xtGet;return b=a.safeObject(b),a.xt(b.domElement)?(b.width=d(b.width,b.domElement.style.width,a.work.d.Stack.width),b.height=d(b.height,b.domElement.style.height,a.work.d.Stack.height),b.name=d(b.elementName,b.name,b.domElement.id,b.domElement.name,"Element"),a.PageElement.call(this,b),this.name.match(/~~~/)&&(this.name=this.name.replace(/~~~/g,"_")),b.domElement.id=this.name,b.domElement.style.position="absolute",a.element[this.name]=this,a.elm[this.name]=b.domElement,a.pushUnique(a.elementnames,this.name),this.setDisplayOffsets(),this.setStyles(b),this.setTransformOrigin(),this.group&&(c=a.elm[this.name].style,c.margin="0",c.webkitBoxSizing="border-box",c.mozBoxSizing="border-box",c.boxSizing="border-box"),this.interactive=d(b.interactive,!1),this.interactive&&this.addMouseMove(),this):!1},a.Element.prototype=Object.create(a.PageElement.prototype),a.Element.prototype.type="Element",a.Element.prototype.classname="elementnames",a.work.d.Element={height:"auto"},a.mergeInto(a.work.d.Element,a.work.d.PageElement),a.Element.prototype.getElement=function(){return a.elm[this.name]},a.ElementGroup=function(b){var c=a.xt,d=a.xtGet,e=a.pushUnique;return b=a.safeObject(b),a.Base.call(this,b),this.entitys=c(b.entitys)?[].concat(b.entitys):[],this.elements=c(b.elements)?[].concat(b.elements):[],this.stack=b.stack||!1,this.equalWidth=d(b.equalWidth,!1),this.equalHeight=d(b.equalHeight,!1),this.currentWidth=0,this.currentHeight=0,this.stack&&e(a.stack[this.stack].groups,this.name),a.group[this.name]=this,e(a.groupnames,this.name),this},a.ElementGroup.prototype=Object.create(a.Base.prototype),a.ElementGroup.prototype.type="ElementGroup",a.ElementGroup.prototype.classname="groupnames",a.work.d.ElementGroup={entitys:[],elements:[],currentWidth:!1,currentHeight:!1,equalWidth:!1,equalHeight:!1,recalculateDimensions:!1,stack:""},a.mergeInto(a.work.d.ElementGroup,a.work.d.Base),a.ElementGroup.prototype.set=function(b){return a.Group.prototype.set.call(this,b)},a.ElementGroup.prototype.sortEntitys=function(b){return a.Group.prototype.sortEntitys.call(this,b)},a.ElementGroup.prototype.forceStamp=function(b,c,d){return a.Group.prototype.forceStamp.call(this,b,c,d)},a.ElementGroup.prototype.stamp=function(b,c,d){var e=a.xtGet;return c=e(c,this.stack),d=e(d,a.stack[this.stack]),a.Group.prototype.stamp.call(this,b,c,d)},a.ElementGroup.prototype.filtersGroupInit=function(){return a.Group.prototype.filtersGroupInit.call(this,arguments)},a.ElementGroup.prototype.addEntitysToGroup=function(){return a.Group.prototype.addEntitysToGroup.call(this,arguments)},a.ElementGroup.prototype.removeEntitysFromGroup=function(){return a.Group.prototype.removeEntitysFromGroup.call(this,arguments)},a.ElementGroup.prototype.updateEntitysBy=function(b){return a.Group.prototype.updateEntitysBy.call(this,b)},a.ElementGroup.prototype.setEntitysTo=function(b){return a.Group.prototype.setEntitysTo.call(this,b)},a.ElementGroup.prototype.pivotEntitysTo=function(b){return a.Group.prototype.pivotEntitysTo.call(this,b)},a.ElementGroup.prototype.getEntityAt=function(b){return a.Group.prototype.getEntityAt.call(this,b)},a.ElementGroup.prototype.getEntitysByMouseIndex=function(b){return a.Group.prototype.getEntitysByMouseIndex.call(this,b)},a.ElementGroup.prototype.getAllEntitysAt=function(b){return a.Group.prototype.getAllEntitysAt.call(this,b)},a.ElementGroup.prototype.sortElements=function(b){(b||this.entitySort&&this.resort)&&(this.resort=!1,this.elements=a.multiSectionBucketSort(["stack","pad","element"],"order",this.elements))},a.ElementGroup.prototype.getElementGroupDimensions=function(){var b,c,d,e,f,g,h,i={width:0,height:0},j=this.elements;for(e=0,f=j.length;f>e;e++)if(c=a.stack[j[e]]||a.pad[j[e]]||a.element[j[e]]||!1,c.visibility)switch(d=c.getElement(),g=c.currentHandle,h=d.style,c.type){case"Stack":b=c.getStackDimensions(),i.width=b.width>i.width?b.width:i.width,i.height=b.height>i.height?b.height:i.height;break;default:b=parseFloat(h.left)+c.localWidth-g.x,i.width=b>i.width?b:i.width,b=parseFloat(h.top)+c.localHeight-g.y,i.height=b>i.height?b:i.height}return i},a.ElementGroup.prototype.render=function(){var b,c,d,e=this.elements,f=a.group;if(this.recalculateDimensions){for(b=0,c=e.length;c>b;b++)d=a.stack[e[b]]||a.pad[e[b]]||a.element[e[b]]||!1,d&&d.setLocalDimensions();this.recalculateDimensions=!1}if(this.checkEqualDimensions())for(this.currentWidth=0,this.currentHeight=0,b=0,c=e.length;c>b;b++)d=a.stack[e[b]]||a.pad[e[b]]||a.element[e[b]]||!1,d&&(d.localWidth>this.currentWidth&&(this.currentWidth=d.localWidth),d.localHeight>this.currentHeight&&(this.currentHeight=d.localHeight));for(b=0,c=e.length;c>b;b++)d=a.stack[e[b]]||a.pad[e[b]]||a.element[e[b]]||!1,d&&(d.renderElement(),"Stack"===d.type&&f[d.name].render());return this},a.ElementGroup.prototype.renderPads=function(){var b,c,d,e=this.elements,f=a.group,g=a.stack,h=a.element,i=a.pad;for(b=0,c=e.length;c>b;b++)d=g[e[b]]||i[e[b]]||h[e[b]]||!1,d&&("Stack"===d.type&&f[d.name].renderPads(),"Pad"===d.type&&i[d.name].render());return this},a.ElementGroup.prototype.domInit=function(){var b,c,d,e=this.elements,f=a.group;for(b=0,c=e.length;c>b;b++)d=a.stack[e[b]]||a.pad[e[b]]||a.element[e[b]]||!1,d.domInitialize(),"Stack"===d.type&&f[d.name].domInit();return this},a.ElementGroup.prototype.update=function(b){var c,d,e,f=this.elements,g=a.group;for(c=0,d=f.length;d>c;c++)e=a.stack[f[c]]||a.pad[f[c]]||a.element[f[c]]||!1,e.update3d(b),"Stack"===e.type&&g[e.name].update(b);return this},a.ElementGroup.prototype.checkEqualDimensions=function(){return this.equalHeight||this.equalWidth?!0:!1},a.ElementGroup.prototype.addElementsToGroup=function(b){var c,d,e=this.elements,f=a.pushUnique;for(b=a.xt(b)?[].concat(b):[],c=0,d=b.length;d>c;c++)f(e,b[c]);return this},a.ElementGroup.prototype.removeElementsFromGroup=function(b){var c,d,e=this.elements,f=a.removeItem;for(b=a.xt(b)?[].concat(b):[],c=0,d=b.length;d>c;c++)f(e,b[c]);return this},a.ElementGroup.prototype.updateElementsBy=function(b){var c,d,e,f=this.elements;for(b=a.safeObject(b),c=0,d=f.length;d>c;c++)e=a.stack[f[c]]||a.pad[f[c]]||a.element[f[c]]||!1,e.setDelta(b);return this},a.ElementGroup.prototype.updateBy=function(a){return this.updateElementsBy(a),this.updateEntitysBy(a),this},a.ElementGroup.prototype.setElementsTo=function(b){var c,d,e,f=this.elements;for(c=0,d=f.length;d>c;c++)e=a.stack[f[c]]||a.pad[f[c]]||a.element[f[c]]||!1,e.set(b);return this},a.ElementGroup.prototype.updateDimensions=function(){var b,c,d,e=this.elements;for(b=0,c=e.length;c>b;b++)d=a.stack[e[b]]||a.pad[e[b]]||a.element[e[b]]||!1,d.setLocalDimensions(),d.setDimensions(),d.currentHandle.flag=!1,"Stack"===d.type&&a.group[d.name].updateDimensions();return this},a.ElementGroup.prototype.setTo=function(a){return this.setElementsTo(a),this.setEntitysTo(a),this},a.ElementGroup.prototype.getAt=function(b,c){var d,e=a.xtGet(c,!1);return e?(d=this.getElementAt(b),d?d:this.getEntityAt(b)):(d=this.getEntityAt(b),d?d:this.getElementAt(b))},a.ElementGroup.prototype.getByMouseIndex=function(a){var b=[];return b.concat(this.getEntitysByMouseIndex(a)),b.concat(this.getElementsByMouseIndex(a)),b},a.ElementGroup.prototype.getAllAt=function(){var a=[];return a.concat(this.getAllEntitysAt(item)),a.concat(this.getAllElementsAt(item)),a},a.ElementGroup.prototype.getElementAt=function(b){var c,d,e,f,g=this.elements,h=a.xtGet;for(this.sortElements(!0),d=g.length-1;d>=0;d--)if(e=g[d],c=h(a.stack[e],a.pad[e],a.element[e]),c.interactive&&c.drag&&c.mice&&(f=c.mice[b.id],f&&f.active))return c;return!1},a.ElementGroup.prototype.getElementsByMouseIndex=function(){return[]},a.ElementGroup.prototype.getAllElementsAt=function(){return[]},a.ElementGroup.prototype.pivotElementsTo=function(b){var c,d,e,f,g,h,i={pivot:"",handleX:0,handleY:0},j=a.work.v,k=this.elements;if(b=b.substring?b:!1,b&&(e=a.stack[b]||a.pad[b]||a.element[b]||a.entity[b]||a.point[b]||!1))for(f="Point"===e.type?e.local:e.start,c=0,d=k.length;d>c;c++)g=a.stack[k[c]]||a.pad[k[c]]||a.element[k[c]]||!1,g&&(h=j.set(g.start),h.vectorSubtract(f),i.pivot=b,i.handleX=-h.x,i.handleY=-h.y,g.set(i));return this},a.ElementGroup.prototype.setDirtyStarts=function(){var b,c,d,e=a.entity,f=this.entitys,g=this.elements,h=a.stack,i=a.pad,j=a.element,k=a.group,l=a.xt;for(c=0,d=f.length;d>c;c++)b=e[f[c]],l(b)&&b.currentStart&&(b.currentStart.flag=!1);for(c=0,d=g.length;d>c;c++)b=h[g[c]]||i[g[c]]||j[g[c]]||!1,b&&("Stack"===b.type&&k[b.name]&&k[b.name].setDirtyStarts(),b.currentStart.flag=!1);return this},a.ElementGroup.prototype.setDirtyHandles=function(){var b,c,d,e=a.entity,f=this.entitys,g=this.elements,h=a.stack,i=a.pad,j=a.element,k=a.group,l=a.xt;for(c=0,d=f.length;d>c;c++)b=e[f[c]],l(b)&&b.currentHandle&&(b.currentHandle.flag=!1);for(c=0,d=g.length;d>c;c++)b=h[g[c]]||i[g[c]]||j[g[c]]||!1,b&&("Stack"===b.type&&k[b.name]&&k[b.name].setDirtyHandles(),b.currentHandle.flag=!1);return this},a}(scrawl);