/*! scrawl-canvas 2017-01-13 */
if(window.scrawl&&window.scrawl.work.extensions&&!window.scrawl.contains(window.scrawl.work.extensions,"block"))var scrawl=function(a){"use strict";return a.newBlock=function(b){return new a.Block(b)},a.makeBlock=function(b){return new a.Block(b)},a.Block=function(b){var c=a.xtGet,d=a.work.d.Block;return b=a.safeObject(b),a.Entity.call(this,b),a.Position.prototype.set.call(this,b),this.width=c(b.width,d.width),this.height=c(b.height,d.height),this.setLocalDimensions(),this.registerInLibrary(),a.pushUnique(a.group[this.group].entitys,this.name),this},a.Block.prototype=Object.create(a.Entity.prototype),a.Block.prototype.type="Block",a.Block.prototype.classname="entitynames",a.work.d.Block={localWidth:0,localHeight:0},a.mergeInto(a.work.d.Block,a.work.d.Entity),a.Block.prototype.set=function(b){return a.Entity.prototype.set.call(this,b),a.xto(b.width,b.height,b.scale)&&this.setLocalDimensions(),this},a.Block.prototype.setDelta=function(b){return a.Entity.prototype.setDelta.call(this,b),a.xto(b.width,b.height,b.scale)&&this.setLocalDimensions(),this},a.Block.prototype.setLocalDimensions=function(){var b=a.cell[a.group[this.group].cell];return this.localWidth=this.width.substring?parseFloat(this.width)/100*b.actualWidth*this.scale:this.width*this.scale||0,this.localHeight=this.height.substring?parseFloat(this.height)/100*b.actualHeight*this.scale:this.height*this.scale||0,this},a.Block.prototype.clip=function(a,b,c){var d=this.currentHandle;return this.rotateCell(a,c),a.beginPath(),a.rect(d.x,d.y,this.localWidth,this.localHeight),a.clip(),this},a.Block.prototype.clear=function(a,b,c){var d=this.currentHandle;return c.setToClearShape(),this.rotateCell(a,c),a.clearRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.clearWithBackground=function(b,c,d){var e=d.get("backgroundColor"),f=a.ctx[c],g=f.get("fillStyle"),h=f.get("strokeStyle"),i=f.get("globalAlpha"),j=this.currentHandle;return this.rotateCell(b,d),b.fillStyle=e,b.strokeStyle=e,b.globalAlpha=1,b.strokeRect(j.x,j.y,this.localWidth,this.localHeight),b.fillRect(j.x,j.y,this.localWidth,this.localHeight),b.fillStyle=g,b.strokeStyle=h,b.globalAlpha=i,this},a.Block.prototype.draw=function(a,b,c){var d=this.currentHandle;return c.setEngine(this),this.rotateCell(a,c),a.strokeRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.fill=function(a,b,c){var d=this.currentHandle;return c.setEngine(this),this.rotateCell(a,c),a.fillRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.drawFill=function(a,b,c){var d=this.currentHandle;return c.setEngine(this),this.rotateCell(a,c),a.strokeRect(d.x,d.y,this.localWidth,this.localHeight),this.clearShadow(a,c),a.fillRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.fillDraw=function(a,b,c){var d=this.currentHandle;return c.setEngine(this),this.rotateCell(a,c),a.fillRect(d.x,d.y,this.localWidth,this.localHeight),this.clearShadow(a,c),a.strokeRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.sinkInto=function(a,b,c){var d=this.currentHandle;return c.setEngine(this),this.rotateCell(a,c),a.fillRect(d.x,d.y,this.localWidth,this.localHeight),a.strokeRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.floatOver=function(a,b,c){var d=this.currentHandle;return c.setEngine(this),this.rotateCell(a,c),a.strokeRect(d.x,d.y,this.localWidth,this.localHeight),a.fillRect(d.x,d.y,this.localWidth,this.localHeight),this},a.Block.prototype.none=function(){return this},a.Block.prototype.getMaxDimensions=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=b.actualWidth,u=b.actualHeight,v=t/2,w=u/2,x=this.currentStart.x,y=this.currentStart.y,z=this.localWidth,A=this.localHeight,B=this.flipReverse,C=this.flipUpend,D=B?t-x:x,E=C?u-y:y,F=B?-z:z,G=C?-A:A,H=this.currentHandle,I=B?-H.x:H.x,J=C?-H.y:H.y,K=a.ctx[this.context].lineWidth||0,L=Math.ceil,M=Math.floor,N=this.roll,O=a.work.v,P=a.isBetween;return q=B?D+I+F:D+I,s=B?D+I:D+I+F,p=C?E+J+G:E+J,r=C?E+J:E+J+G,N&&(l=Math.min,k=Math.max,o={x:D,y:E},O.set({x:q,y:p}).vectorSubtract(o).rotate(N).vectorAdd(o),c=O.x,g=O.y,O.set({x:s,y:p}).vectorSubtract(o).rotate(N).vectorAdd(o),d=O.x,h=O.y,O.set({x:s,y:r}).vectorSubtract(o).rotate(N).vectorAdd(o),f=O.x,j=O.y,O.set({x:q,y:r}).vectorSubtract(o).rotate(N).vectorAdd(o),e=O.x,i=O.y,m=[c,d,e,f],n=[g,h,i,j],p=l.apply(Math,n),q=l.apply(Math,m),r=k.apply(Math,n),s=k.apply(Math,m)),p=M(p-K),q=M(q-K),r=L(r+K),s=L(s+K),P(p,0,u,!0)||(p=p>w?u:0),P(r,0,u,!0)||(r=r>w?u:0),P(q,0,t,!0)||(q=q>v?t:0),P(s,0,t,!0)||(s=s>v?t:0),this.maxDimensions.top=p,this.maxDimensions.bottom=r,this.maxDimensions.left=q,this.maxDimensions.right=s,this.maxDimensions.flag=!1,this.maxDimensions},a}(scrawl);