/* Version 0.94 */
/*
    Copyright 2008-2012
        Matthias Ehmann,
        Michael Gerhaeuser,
        Carsten Miller,
        Bianca Valentin,
        Alfred Wassermann,
        Peter Wilfahrt

    This file is part of JSXGraph.

    JSXGraph is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    JSXGraph is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with JSXGraph.  If not, see <http://www.gnu.org/licenses/>.
*/
    JXG.debug=function(){};JXG.GeonextReader={changeOriginIds:function(a,b){if((b=="gOOe0")||(b=="gXOe0")||(b=="gYOe0")||(b=="gXLe0")||(b=="gYLe0")){return a.id+b}else{return b}},gEBTN:function(e,b,a,d){var c;if(!JXG.exists(e||!e.getElementsByTagName)){return""}if(!JXG.exists(d)){d=true}a=a||0;c=e.getElementsByTagName(b);if(c.length>0){c=c[a];if(d&&c.firstChild){c=c.firstChild.data}}return c},colorProperties:function(d,c){var b=this.gEBTN(c,"color",0,false),a;a=JXG.rgba2rgbo(this.gEBTN(b,"stroke"));d.strokeColor=a[0];d.strokeOpacity=a[1];a=JXG.rgba2rgbo(this.gEBTN(b,"lighting"));d.highlightStrokeColor=a[0];d.highlightStrokeOpacity=a[1];a=JXG.rgba2rgbo(this.gEBTN(b,"fill"));d.fillColor=a[0];d.fillOpacity=a[1];d.highlightFillColor=d.fillColor;d.highlightFillOpacity=d.fillOpacity;d.labelColor=JXG.rgba2rgbo(this.gEBTN(b,"label"))[0];d.colorDraft=JXG.rgba2rgbo(this.gEBTN(b,"draft"))[0];if(JXG.rgba2rgbo(this.gEBTN(b,"label"))[1]==0){d.withLabel=false}else{d.withLabel=true}d.colorStroke=d.strokeColor;d.colorFill=d.fillColor;d.colorLabel=d.labelColor;return d},firstLevelProperties:function(e,c){if(!JXG.exists(c)||!JXG.exists(c.childNodes)){return e}var a=c.childNodes,d,b;for(d=0;d<a.length;d++){if(JXG.exists(a[d].firstChild)&&a[d].nodeName!=="data"&&a[d].nodeName!=="straight"){b=a[d].nodeName;e[b]=a[d].firstChild.data}}return e},defProperties:function(b,a){if(a.nodeType==3||a.nodeType==8){return null}b.ident=a.nodeName;if(b.ident=="text"||b.ident=="intersection"||b.ident=="composition"){b.name=""}else{b.name=this.gEBTN(a,"name")}b.id=this.gEBTN(a,"id");return b},visualProperties:function(b,a){b.visible=JXG.str2Bool(this.gEBTN(a,"visible"));b.trace=JXG.str2Bool(this.gEBTN(a,"trace"));return b},transformProperties:function(d,a){var b=["cross","cross","cross","circle","circle","circle","circle","square","square","square","plus","plus","plus"],c=[2,3,4,1,2,3,4,2,3,4,2,3,4];d.strokeWidth=d.strokewidth;d.face=b[parseInt(d.style,10)]||"cross";d.size=c[parseInt(d.style,10)]||3;d.straightFirst=JXG.str2Bool(d.straightFirst);d.straightLast=JXG.str2Bool(d.straightLast);d.visible=JXG.str2Bool(d.visible);d.draft=JXG.str2Bool(d.draft);d.trace=JXG.str2Bool(d.trace);if(a==="point"){d.fillColor=d.strokeColor;d.highlightFillColor=d.highlightStrokeColor;d.fillOpacity=d.strokeOpacity;d.highlightFillOpacity=d.highlightStrokeOpacity}if(typeof(d.label==="string")){delete (d.label)}delete d.color;return d},readNodes:function(g,d,b,e){var a=this.gEBTN(d,b,0,false).childNodes,c,f;for(f=0;f<a.length;f++){if(a[f].firstChild!=null){if(e!=null){c=e+JXG.capitalize(a[f].nodeName)}else{c=a[f].nodeName}g[c]=a[f].firstChild.data}}return g},subtreeToString:function(a){try{return(new XMLSerializer()).serializeToString(a)}catch(b){return a.xml}},readImage:function(c){var b="",a=c;if(a!=null){b=a.data;while(a.nextSibling!=null){a=a.nextSibling;b+=a.data}}return b},parseImage:function(i,g,a,l,k,m,f,d){var n,c,j,b,e;if(g==null){return null}if(g.getElementsByTagName("src")[0]!=null){n="src"}else{if(g.getElementsByTagName("image")[0]!=null){n="image"}else{return null}}b=this.readImage(this.gEBTN(g,n,0,false).firstChild);if(b!=""){b="data:image/png;base64,"+b;if(n=="src"){l=this.gEBTN(g,"x");k=this.gEBTN(g,"y");m=this.gEBTN(g,"width");f=this.gEBTN(g,"height");j=i.create("image",[b,[l,k],[m,f]],{anchor:d,layer:a});return j}else{e=new Image();e.src=b;c=d.id+"_image";e.onload=function(){var p=this.width,q=this.height,s,u,r,t,o,h;if(d.elementClass==JXG.OBJECT_CLASS_LINE){s=function(){return d.point1.X()};r=function(){return d.point1.Dist(d.point2)};t=function(){return r()*q/p};u=function(){return d.point1.Y()-t()*0.5};o=i.create("image",[b,[s,u],[r,t]],{layer:a,id:c,anchor:d});h=i.create("transform",[function(){return Math.atan2(d.point2.Y()-d.point1.Y(),d.point2.X()-d.point1.X())},d.point1],{type:"rotate"});h.bindTo(o);d.image=o}else{if(d.elementClass==JXG.OBJECT_CLASS_POINT){r=function(){return p/i.unitX};t=function(){return q/i.unitY};s=function(){return d.X()-r()*0.5};u=function(){return d.Y()-t()*0.5};o=i.create("image",[b,[s,u],[r,t]],{layer:a,id:c,anchor:d});i.renderer.hide(d.label.content);d.image=o}else{if(d.elementClass==JXG.OBJECT_CLASS_CIRCLE){r=function(){return 2*d.Radius()};t=function(){return r()*q/p};s=function(){return d.center.X()-r()*0.5};u=function(){return d.center.Y()-t()*0.5};o=i.create("image",[b,[s,u],[r,t]],{layer:a,id:c,anchor:d});d.image=o}else{o=i.create("image",[b,[l,k],[m,f]],{layer:a,id:c,anchor:d});d.image=o}}}}}return j}},readConditions:function(d){var b,c,a,e="";if(JXG.exists(d)){for(b=0;b<d.getElementsByTagName("data").length;b++){a=d.getElementsByTagName("data")[b];c=this.subtreeToString(a);e+=c}}return e},printDebugMessage:function(a,d,c,b){JXG.debug("* "+b+":  "+c+" "+d.name+" "+d.id+"<br>\n")},readGeonext:function(m,g){var j,n,l,i,d,c,b,a,h,e,k="true",f=this;g.options.layer.sector=g.options.layer.angle;g.options.layer.circle=g.options.layer.angle;g.options.line.label.position="top";c=this.gEBTN(m,"board",0,false);h=this.readConditions(c.getElementsByTagName("conditions")[0]);j=this.gEBTN(c,"coordinates",0,false);e=this.gEBTN(j,"origin",0,false);g.origin={usrCoords:[1,0,0],scrCoords:[1,parseFloat(this.gEBTN(e,"x")),parseFloat(this.gEBTN(e,"y"))]};e=this.gEBTN(j,"zoom",0,false);g.zoomX=parseFloat(this.gEBTN(e,"x"));g.zoomY=parseFloat(this.gEBTN(e,"y"));e=this.gEBTN(j,"unit",0,false);g.unitX=parseFloat(this.gEBTN(e,"x"));g.unitY=parseFloat(this.gEBTN(e,"y"));if(g.options.takeSizeFromFile){g.resizeContainer(this.gEBTN(c,"width"),this.gEBTN(c,"height"))}if(!(parseFloat(g.options.text.fontSize)>0)){g.options.text.fontSize=12}g.geonextCompatibilityMode=true;delete (JXG.JSXGraph.boards[g.id]);g.id=this.gEBTN(c,"id");JXG.JSXGraph.boards[g.id]=g;g.initGeonextBoard();g.renderer.enhancedRendering=true;this.parseImage(g,this.gEBTN(c,"file",0,false),g.options.layer.image);g.options.point.snapToGrid=(this.gEBTN(this.gEBTN(c,"coordinates",0,false),"snap")==k);if(g.options.point.snapToGrid&&this.gEBTN(this.gEBTN(c,"grid",1,false),"pointsnap")==k){g.options.point.snapToGrid=false;g.options.point.snapToPoints=true;g.options.point.attractorDistance=0.5}j=this.gEBTN(c,"grid",1,false);e=this.gEBTN(j,"x");if(e){g.options.grid.gridX=1/parseFloat(e);g.options.point.snapSizeX=parseFloat(e)}e=this.gEBTN(j,"y");if(e){g.options.grid.gridY=1/parseFloat(e);g.options.point.snapSizeY=parseFloat(e)}g.options.grid.gridDash=JXG.str2Bool(this.gEBTN(j,"dash"));e=JXG.rgba2rgbo(this.gEBTN(j,"color"));g.options.grid.gridColor=e[0];g.options.grid.gridOpacity=e[1];j=this.gEBTN(c,"coordinates",0,false);if(this.gEBTN(j,"grid")==k){g.create("grid",[])}if(this.gEBTN(j,"coord")==k){g.options.axis.ticks.majorHeight=10;g.options.axis.ticks.minorHeight=4;g.create("axis",[[0,0],[1,0]]);g.create("axis",[[0,0],[0,1]])}g.containerObj.style.backgroundColor=JXG.rgba2rgbo(this.gEBTN(this.gEBTN(c,"background",0,false),"color"))[0];n=m.getElementsByTagName("elements")[0].childNodes;for(l=0;l<n.length;l++){(function(I){var z,r={},u,G,F,D,B,q,o,t,E,w;i=n[I];r=f.defProperties(r,i);if(!JXG.exists(r)){return}f.printDebugMessage("debug",r,i.nodeName.toLowerCase,"READ:");switch(i.nodeName.toLowerCase()){case"point":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r.fixed=JXG.str2Bool(f.gEBTN(i,"fix"));r=f.transformProperties(r,"point");o=g.create("point",[parseFloat(r.x),parseFloat(r.y)],r);var H=function(){return o.visProp.visible};q=f.parseImage(g,i,g.options.layer.image,0,0,0,0,o);f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"line":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r=f.readNodes(r,i,"straight","straight");r=f.transformProperties(r);r.first=f.changeOriginIds(g,r.first);r.last=f.changeOriginIds(g,r.last);u=g.create("line",[r.first,r.last],r);f.parseImage(g,i,g.options.layer.image,0,0,0,0,u);f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"circle":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);w=f.gEBTN(i,"data",0,false);r.center=f.changeOriginIds(g,f.gEBTN(w,"midpoint"));if(w.getElementsByTagName("radius").length>0){r.radius=f.changeOriginIds(g,f.gEBTN(w,"radius"))}else{if(w.getElementsByTagName("radiusvalue").length>0){r.radius=f.gEBTN(w,"radiusvalue")}}r=f.transformProperties(r);D=g.create("circle",[r.center,r.radius],r);f.parseImage(g,i,g.options.layer.image,0,0,0,0,D);f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"slider":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r.fixed=JXG.str2Bool(f.gEBTN(i,"fix"));r=f.readNodes(r,i,"animate","animate");r=f.transformProperties(r,"point");try{r.parent=f.changeOriginIds(g,r.parent);o=g.create("glider",[parseFloat(r.x),parseFloat(r.y),r.parent],r);o.onPolygon=JXG.exists(r.onpolygon)&&JXG.str2Bool(r.onpolygon);f.parseImage(g,i,g.options.layer.point,0,0,0,0,o);f.printDebugMessage("debug",r,i.nodeName,"OK")}catch(C){JXG.debug("* <b>Err:</b>  Slider "+r.name+" "+r.id+": "+r.parent+"<br>\n")}break;case"cas":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r.fixed=JXG.str2Bool(i.getElementsByTagName("fix")[0].firstChild.data);r=f.readNodes(r,i,"data");r=f.transformProperties(r,"point");if(false){r.x=JXG.GeonextParser.gxt2jc(r.x,g);r.y=JXG.GeonextParser.gxt2jc(r.y,g)}else{r.x=JXG.GeonextParser.geonext2JS(r.x,g);r.x=new Function("return "+r.x+";");r.y=JXG.GeonextParser.geonext2JS(r.y,g);r.y=new Function("return "+r.y+";")}o=g.create("point",[r.x,r.y],r);f.parseImage(g,i,g.options.layer.point,0,0,0,0,o);f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"intersection":r=f.readNodes(r,i,"data");j=i.getElementsByTagName("first")[1];r.outFirst={};r.outFirst=f.colorProperties(r.outFirst,j);r.outFirst=f.visualProperties(r.outFirst,j);r.outFirst=f.firstLevelProperties(r.outFirst,j);r.outFirst.fixed=JXG.str2Bool(j.getElementsByTagName("fix")[0].firstChild.data);r.outFirst=f.transformProperties(r.outFirst,"point");r.first=f.changeOriginIds(g,r.first);r.last=f.changeOriginIds(g,r.last);if((JXG.getReference(g,r.first).elementClass==JXG.OBJECT_CLASS_LINE)&&(JXG.getReference(g,r.last).elementClass==JXG.OBJECT_CLASS_LINE)){t=g.create("intersection",[g.objects[r.first],g.objects[r.last],0],r.outFirst);if(r.outFirst.visible=="false"){t.hideElement()}}else{j=i.getElementsByTagName("last")[1];if(JXG.exists(j)){r.outLast={};r.outLast=f.colorProperties(r.outLast,j);r.outLast=f.visualProperties(r.outLast,j);r.outLast=f.firstLevelProperties(r.outLast,j);r.outLast.fixed=JXG.str2Bool(j.getElementsByTagName("fix")[0].firstChild.data);r.outLast=f.transformProperties(r.outLast,"point");t=g.create("intersection",[g.objects[r.first],g.objects[r.last],0],r.outFirst);t=g.create("intersection",[g.objects[r.first],g.objects[r.last],1],r.outLast)}}f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"composition":r=f.readNodes(r,i,"data");r=f.firstLevelProperties(r,i);r.defEl=[];B=0;j=i.getElementsByTagName("data")[0].getElementsByTagName("input");for(z=0;z<j.length;z++){r.defEl[z]=j[z].firstChild.data;B=z+1}j=i.getElementsByTagName("output")[0];r.out={};r.out=f.colorProperties(r.out,j);r.out=f.visualProperties(r.out,j);r.out=f.firstLevelProperties(r.out,j);r.out=f.transformProperties(r.out);r.defEl[0]=f.changeOriginIds(g,r.defEl[0]);r.defEl[1]=f.changeOriginIds(g,r.defEl[1]);r.defEl[2]=f.changeOriginIds(g,r.defEl[2]);switch(r.type){case"210070":r.out.fixed=f.gEBTN(j,"fix");j=i.getElementsByTagName("output")[1];r.outPoint={};r.outPoint=f.defProperties(r.outPoint,j);r.outPoint=f.colorProperties(r.outPoint,j);r.outPoint=f.visualProperties(r.outPoint,j);r.outPoint=f.firstLevelProperties(r.outPoint,j);r.outPoint=f.transformProperties(r.outPoint);r.out.point=r.outPoint;g.create("arrowparallel",[r.defEl[1],r.defEl[0]],r.out);break;case"210080":r.out.straightFirst=false;g.create("bisector",[r.defEl[0],r.defEl[1],r.defEl[2]],r.out);break;case"210090":j=i.getElementsByTagName("output")[1];r.outCircle={};r.outCircle=f.defProperties(r.outCircle,j);r.outCircle=f.colorProperties(r.outCircle,j);r.outCircle=f.visualProperties(r.outCircle,j);r.outCircle=f.firstLevelProperties(r.outCircle,j);r.outCircle=f.transformProperties(r.outCircle);r.outCircle.point=r.out;g.create("circumcircle",[r.defEl[0],r.defEl[1],r.defEl[2]],r.outCircle);break;case"210100":g.create("circumcenter",[r.defEl[0],r.defEl[1],r.defEl[2]],r.out);break;case"210110":g.create("midpoint",r.defEl.slice(0,B),r.out);break;case"210120":g.create("reflection",[r.defEl[1],r.defEl[0]],r.out);break;case"210125":g.create("mirrorpoint",[r.defEl[0],r.defEl[1]],r.out);break;case"210130":g.create("perpendicularsegment",[r.defEl[0],r.defEl[1]],r.out);break;case"210140":o=g.create("parallelpoint",[r.defEl[1],r.defEl[0]],{withLabel:false,visible:false,name:"",fixed:true});q=g.create("line",[r.defEl[0],o],r.out);q.parallelpoint=o;break;case"210150":g.create("parallelpoint",r.defEl.slice(0,B),r.out);break;case"210160":r.out.fixed=f.gEBTN(j,"fix");j=i.getElementsByTagName("output")[1];r.outLine={};r.outLine=f.defProperties(r.outLine,j);r.outLine=f.colorProperties(r.outLine,j);r.outLine=f.visualProperties(r.outLine,j);r.outLine=f.firstLevelProperties(r.outLine,j);r.outLine=f.readNodes(r.outLine,j,"straight","straight");r.outLine=f.transformProperties(r.outLine);r.outLine.point=r.out;g.create("perpendicularsegment",[r.defEl[1],r.defEl[0]],r.outLine);break;case"210170":g.create("perpendicularpoint",[r.defEl[1],r.defEl[0]],r.out);break;case"210180":throw new Error("JSXGraph: Element ROTATION not yet implemented.");break;case"210190":r.out=f.defProperties(r.out,j);r.out.firstArrow=JXG.str2Bool(f.gEBTN(j,"firstarrow"));r.out.lastArrow=JXG.str2Bool(f.gEBTN(j,"lastarrow"));for(z=0;z<4;z++){j=i.getElementsByTagName("output")[z];r.out=f.defProperties(r.out,j);r.out=f.colorProperties(r.out,j);r.out=f.visualProperties(r.out,j);r.out=f.firstLevelProperties(r.out,j);r.out=f.transformProperties(r.out);if(z==0){q=g.create("sector",r.defEl,r.out)}else{if(z==1){o=g.create("point",[function(){var s=JXG.getRef(g,r.defEl[1]),p=JXG.getRef(g,r.defEl[2]);return s.X()+(p.X()-s.X())*q.Radius/s.Dist(p)},function(){var s=JXG.getRef(g,r.defEl[1]),p=JXG.getRef(g,r.defEl[2]);return s.Y()+(p.Y()-s.Y())*q.Radius/s.Dist(p)}],r.out)}else{if(z==2){q=g.create("segment",[r.defEl[0],r.defEl[1]],r.out)}else{if(z==3){q=g.create("segment",[r.defEl[1],o],r.out)}}}}}break;default:throw new Error("JSXGraph: GEONExT-Element "+r.type+" not implemented.");break}f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"polygon":r=f.colorProperties(r,i);r=f.firstLevelProperties(r,i);var A=[];for(z=0;z<i.getElementsByTagName("data")[0].getElementsByTagName("vertex").length-1;z++){A[z]=i.getElementsByTagName("data")[0].getElementsByTagName("vertex")[z].firstChild.data;A[z]=f.changeOriginIds(g,A[z])}r.border=[];r.borders={ids:[]};for(z=0;z<i.getElementsByTagName("border").length;z++){r.border[z]={};j=i.getElementsByTagName("border")[z];r.border[z].id=j.getElementsByTagName("id")[0].firstChild.data;r.borders.ids.push(r.border[z].id);r.border[z].name=j.getElementsByTagName("name")[0].firstChild.data;r.border[z].straightFirst=JXG.str2Bool(j.getElementsByTagName("straight")[0].getElementsByTagName("first")[0].firstChild.data);r.border[z].straightLast=JXG.str2Bool(j.getElementsByTagName("straight")[0].getElementsByTagName("last")[0].firstChild.data);r.border[z].strokeWidth=j.getElementsByTagName("strokewidth")[0].firstChild.data;r.border[z].dash=JXG.str2Bool(j.getElementsByTagName("dash")[0].firstChild.data);r.border[z].visible=JXG.str2Bool(j.getElementsByTagName("visible")[0].firstChild.data);r.border[z].draft=JXG.str2Bool(j.getElementsByTagName("draft")[0].firstChild.data);r.border[z].trace=JXG.str2Bool(j.getElementsByTagName("trace")[0].firstChild.data);j=i.getElementsByTagName("border")[z].getElementsByTagName("color")[0];E=JXG.rgba2rgbo(j.getElementsByTagName("stroke")[0].firstChild.data);r.border[z].strokeColor=E[0];r.border[z].strokeOpacity=E[1];E=JXG.rgba2rgbo(j.getElementsByTagName("lighting")[0].firstChild.data);r.border[z].highlightStrokeColor=E[0];r.border[z].highlightStrokeOpacity=E[1];E=JXG.rgba2rgbo(j.getElementsByTagName("fill")[0].firstChild.data);r.border[z].fillColor=E[0];r.border[z].fillOpacity=E[1];r.border[z].highlightFillColor=r.border[z].fillColor;r.border[z].highlightFillOpacity=r.border[z].fillOpacity;r.border[z].labelColor=j.getElementsByTagName("label")[0].firstChild.data;r.border[z].colorDraft=j.getElementsByTagName("draft")[0].firstChild.data}r=f.transformProperties(r);o=g.create("polygon",A,r);for(z=0;z<o.borders.length;z++){o.borders[z].setProperty(r.border[z])}f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"graph":r=f.colorProperties(r,i);r=f.firstLevelProperties(r,i);r.funct=i.getElementsByTagName("data")[0].getElementsByTagName("function")[0].firstChild.data;if(false){r.funct=JXG.GeonextParser.gxt2jc(r.funct,g)}else{r.funct=JXG.GeonextParser.geonext2JS(r.funct,g);r.funct=new Function("x","return "+r.funct+";")}D=g.create("curve",["x",r.funct],{id:r.id,name:r.name,strokeColor:r.strokeColor,strokeWidth:r.strokeWidth,fillColor:"none",highlightFillColor:"none",highlightStrokeColor:r.highlightStrokeColor,visible:JXG.str2Bool(r.visible)});f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"arrow":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r=f.readNodes(r,i,"straight","straight");r=f.transformProperties(r);r.first=f.changeOriginIds(g,r.first);r.last=f.changeOriginIds(g,r.last);u=g.create("arrow",[r.first,r.last],r);f.printDebugMessage("debug",u,i.nodeName,"OK");break;case"arc":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r.firstArrow=JXG.str2Bool(i.getElementsByTagName("lastarrow")[0].firstChild.data);r.lastArrow=JXG.str2Bool(i.getElementsByTagName("firstarrow")[0].firstChild.data);r=f.transformProperties(r);r.center=f.changeOriginIds(g,r.midpoint);r.angle=f.changeOriginIds(g,r.angle);r.radius=f.changeOriginIds(g,r.radius);D=g.create("arc",[r.center,r.radius,r.angle],r);f.printDebugMessage("debug",D,i.nodeName,"OK");break;case"angle":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r=f.transformProperties(r);w=r.name;try{r.name=i.getElementsByTagName("text")[0].firstChild.data}catch(C){r.name=""}D=g.create("angle",[r.first,r.middle,r.last],r);D.setProperty({name:w});f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"text":if(r.id.match(/oldVersion/)){break}r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.readNodes(r,i,"data");r.mpStr=f.subtreeToString(i.getElementsByTagName("data")[0].getElementsByTagName("mp")[0]);r.mpStr=r.mpStr.replace(/<\/?mp>/g,"");r.fixed=false;try{if(i.getElementsByTagName("data")[0].getElementsByTagName("parent")[0].firstChild){r.parent=i.getElementsByTagName("data")[0].getElementsByTagName("parent")[0].firstChild.data;r.fixed=true}}catch(C){}r.condition=i.getElementsByTagName("condition")[0].firstChild.data;r.content=i.getElementsByTagName("content")[0].firstChild.data;r.fix=i.getElementsByTagName("fix")[0].firstChild.data;r.autodigits=i.getElementsByTagName("digits")[0].firstChild.data;r.parent=f.changeOriginIds(g,r.parent);D=g.create("text",[r.x,r.y,r.mpStr],{anchor:r.parent,id:r.id,name:r.name,digits:r.autodigits,isLabel:false,strokeColor:r.colorLabel,fixed:r.fixed,visible:JXG.str2Bool(r.visible)});break;case"parametercurve":r=f.colorProperties(r,i);r=f.visualProperties(r,i);r=f.firstLevelProperties(r,i);r=f.transformProperties(r);r.functionx=i.getElementsByTagName("functionx")[0].firstChild.data;r.functiony=i.getElementsByTagName("functiony")[0].firstChild.data;r.min=i.getElementsByTagName("min")[0].firstChild.data;r.max=i.getElementsByTagName("max")[0].firstChild.data;r.fillColor="none";r.highlightFillColor="none";g.create("curve",[new Function("t","return "+JXG.GeonextParser.geonext2JS(r.functionx,g)+";"),new Function("t","return "+JXG.GeonextParser.geonext2JS(r.functiony,g)+";"),new Function("return "+JXG.GeonextParser.geonext2JS(r.min,g)+";"),new Function("return "+JXG.GeonextParser.geonext2JS(r.max,g)+";")],r);f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"tracecurve":r.tracepoint=i.getElementsByTagName("tracepoint")[0].firstChild.data;r.traceslider=i.getElementsByTagName("traceslider")[0].firstChild.data;g.create("tracecurve",[r.traceslider,r.tracepoint],r);f.printDebugMessage("debug",r,i.nodeName,"OK");break;case"group":r=f.colorProperties(r,i);r=f.firstLevelProperties(r,i);r.members=[];for(z=0;z<i.getElementsByTagName("data")[0].getElementsByTagName("member").length;z++){r.members[z]=i.getElementsByTagName("data")[0].getElementsByTagName("member")[z].firstChild.data;r.members[z]=f.changeOriginIds(g,r.members[z])}D=new JXG.Group(g,r.id,r.name,r.members);f.printDebugMessage("debug",r,i.nodeName,"OK");break;default:JXG.debug("* <b>Err:</b> "+i.nodeName+" not yet implemented <br>\n")}delete (r)})(l)}g.addConditions(h)},decodeString:function(b){var a;if(b.indexOf("<GEONEXT>")<0){a=(new JXG.Util.Unzip(JXG.Util.Base64.decodeAsArray(b))).unzip();if(a==""){return b}else{return a}}else{return b}},prepareString:function(a){try{if(a.indexOf("GEONEXT")<0){a=(this.decodeString(a))[0][0]}a=this.fixXML(a)}catch(b){a=""}return a},fixXML:function(e){var a=["active","angle","animate","animated","arc","area","arrow","author","autodigits","axis","back","background","board","border","bottom","buttonsize","cas","circle","color","comment","composition","condition","conditions","content","continuous","control","coord","coordinates","cross","cs","dash","data","description","digits","direction","draft","editable","elements","event","file","fill","first","firstarrow","fix","fontsize","free","full","function","functionx","functiony","GEONEXT","graph","grid","group","height","id","image","info","information","input","intersection","item","jsf","label","last","lastarrow","left","lefttoolbar","lighting","line","loop","max","maximized","member","middle","midpoint","min","modifier","modus","mp","mpx","multi","name","onpolygon","order","origin","output","overline","parametercurve","parent","point","pointsnap","polygon","position","radius","radiusnum","radiusvalue","right","section","selectedlefttoolbar","showconstruction","showcoord","showinfo","showunit","showx","showy","size","slider","snap","speed","src","start","stop","straight","stroke","strokewidth","style","term","text","top","trace","tracecurve","tracepoint","traceslider","type","unit","value","VERSION","vertex","viewport","visible","width","wot","x","xooy","xval","y","yval","zoom"],c=a.join("|"),b="&lt;(/?("+c+"))&gt;",d=new RegExp(b,"g");e=JXG.escapeHTML(e);e=e.replace(d,"<$1>");e=e.replace(/(<content>.*)<arc>(.*<\/content>)/g,"$1&lt;arc&gt;$2");e=e.replace(/(<mp>.*)<arc>(.*<\/mpx>)/g,"$1&lt;arc&gt;$2");e=e.replace(/(<mpx>.*)<arc>(.*<\/mpx>)/g,"$1&lt;arc&gt;$2");return e}};